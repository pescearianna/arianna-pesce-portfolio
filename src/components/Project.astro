---
import { Icon } from "astro-icon/components";
import type { CollectionEntry } from "astro:content";

interface Props {
  project: CollectionEntry<"projects">;
}
const { project } = Astro.props;

const uniqueId = `project-card-${project.slug}`;
---

<style>
  .project {
    min-height: 60vh;
    .card {
      .box {
        border-radius: 5%;

        box-shadow: 2px 2px 10px rgba(255, 255, 255, 0.8);
        #cover-prj {
          display: block;

          width: 100%;
          height: 100%;
        }
      }
    }
    .details {
      color: var(--text-color);
      .tech {
        text-align: center;
        font-size: 1rem;
      }
      .text {
        hr {
          width: 65%;
          height: 1px;
          border: 3px solid var(--th-color);
          border-radius: 10px;

          margin: 0 auto 1.5rem;
        }
        p {
          font-size: 1.2rem;
          margin-bottom: 2rem;
          line-height: 1.6rem;
        }
      }

      .cta {
        display: flex;
        justify-content: space-evenly;
        align-items: center;
        .links-p {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 1.5rem;
          a {
            font-size: 1.2rem;
            text-decoration: none;
            color: var(--color-primary);
          }
        }
      }
    }
  }

  @media screen and (max-width: 1224px) {
    .project {
      .card {
        width: 100%;
        .box {
          margin: 2rem auto;
          height: 300px;
          width: 300px;
        }
        #cover-prj {
          margin: auto;
          border-radius: 5%;
        }
      }

      .details {
        color: var(--text-color);
        text-align: center;
        .tech {
          font-size: 1rem;
        }
        .text {
          margin-bottom: 2rem;
          h2 {
            margin: 1rem 0 0.5rem;
          }
        }
        .cta {
          margin-bottom: 3rem;
          padding-bottom: 1rem;
          border-bottom: 2px solid transparent;
          border-image-source: radial-gradient(
            circle,
            var(--fo-color) 0%,
            var(--bg-color) 90%
          );
          border-image-slice: 1;
          p {
            display: none;
          }
        }
      }
    }
  }

  @media screen and (min-width: 1224px) {
    .project {
      --size: 500px;

      display: flex;
      justify-content: space-evenly;
      align-items: center;
      margin: 2rem 0;
      padding: 1rem;
      .card {
        width: 45%;
        height: 100%;
        height: auto;
        position: relative;
        perspective: 1000px;
      }
      .box {
        /* position: relative; */
        width: auto;
        height: auto;
        overflow: hidden;
        scale: 0.7;
        border-radius: 5%;
        transform: rotateX(0deg) rotateY(0deg);
        box-shadow: 2px 2px 10px rgba(255, 255, 255, 0.8);

        cursor: none;
        &:hover {
          scale: 0.9;

          /* box-shadow: -15px -15px 20px rgba(255, 255, 255, 0.596);  */
          transition: all 0.3s ease-out;
        }
        .box:hover + .details {
          opacity: 1;
        }
      }

      img {
        display: block;

        width: 100%;
        height: 100%;
      }
    }
    .light {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      background: radial-gradient(
        circle at 50% 50%,
        rgba(255, 255, 255, 0.1),
        transparent 30%
      );
      transition: background-position 0.1s;
    }

    .details {
      width: 49%;
      padding: 1rem 4rem 2rem;
      color: var(--text-color);
      opacity: 0;

      .tech {
        text-align: center;
        font-size: 1rem;
      }
      .text {
        margin-top: 1rem;

        h2 {
          font-size: 2.5rem;
          margin-bottom: 0;
          transform: capitalize;
          text-align: center;
        }
      }
      .cta {
        display: flex;
        justify-content: space-evenly;
        align-items: center;
        .links-p {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 1.5rem;
          a {
            font-size: 1.2rem;
            text-decoration: none;
            color: var(--color-primary);
          }
        }
      }
    }
  }

</style>

<section class="project" data-project-container>
  <div class="card">
    <div class="box" id={`${uniqueId}-box`}>
      <img id="cover-prj" src={project.data.cover} alt={project.data.title} />
      <div class="light" id={`${uniqueId}-light`}></div>
    </div>
  </div>

  <div class="details" id={`${uniqueId}-details`}>
    <p class="tech">{project.data.tech}</p>
    <div class="text">
      <h2>{project.data.title}</h2>
      <hr />
      <p>{project.data.description}</p>
      <!-- <a href={`/portfolio/${project.slug}`}>Discover more:</a> -->
    </div>
    <div class="cta">
      <p>Discover more:</p>
      <div class="links-p">
        <a href={project.data.github} target="_blank"
          ><Icon class="icon" name="line-md:github-twotone" size="4rem" /></a
        >
        <a href={project.data.app} target="_blank"
          ><Icon class="icon" name="line-md:link" size="4rem" /></a
        >
      </div>
    </div>
  </div>
</section>

<script define:vars={{ uniqueId }}>
  window.addEventListener("resize", () => {
    if (window.innerWidth >= 1024) {
      // Il valore di uniqueId viene iniettato nello script
      const box = document.getElementById(`${uniqueId}-box`);
      const light = document.getElementById(`${uniqueId}-light`);
      const details = document.getElementById(`${uniqueId}-details`);

      if (box && light) {
        box.addEventListener("mousemove", (e) => {
          const rect = box.getBoundingClientRect();

          // 2. Calcola la posizione del mouse rispetto all'angolo in alto a sinistra del box
          const xCursor = e.clientX - rect.left;
          const yCursor = e.clientY - rect.top;

          // 3. Calcola il centro del box
          const centerX = rect.width / 2;
          const centerY = rect.height / 2;

          // 4. Calcola la distanza dal centro del box
          //    (Questa sarà zero al centro e massima ai bordi)
          const deltaX = centerX - xCursor;
          const deltaY = centerY - yCursor;

          //     // 5. Normalizza i valori e riduci la sensibilità (ad esempio, dividi per 15 o 20)
          //    Il segno (positivo/negativo) controlla la direzione della rotazione.
          const rotateX = deltaX / 15; // Più grande è il divisore, meno ruota
          const rotateY = deltaY / 15;

          //     // Applica la rotazione (inverti rotateX e rotateY per l'effetto di parallasse)
          box.style.transform = `rotateY(${rotateX}deg) rotateX(${-rotateY}deg)`;
          box.style.boxShadow = `${-rotateX}px ${-rotateY}px 30px rgba(255, 255, 255, 0.60)`;
          const x = e.clientX - rect.left; // posizione x dentro box
          const y = e.clientY - rect.top; // posizione y dentro box

          light.style.background = `
       radial-gradient(
         circle at ${x}px ${y}px,
         rgba(255,255,255,0.4),
         transparent 30%
       )`;

          details.style.opacity = 1;
          details.style.transition = "opacity 1s ease-in";
        });

        box.addEventListener("mouseleave", () => {
          // quando il mouse esce, puoi far scomparire o spostare il gradiente
          light.style.background = "";
        });
      }
    }
  });
</script>
