---
import { Icon } from "astro-icon/components";
import {Image} from "astro:assets";
import type { CollectionEntry } from "astro:content";

interface Props {
  project: CollectionEntry<"projects">;
}
const { project } = Astro.props;

const uniqueId = `project-card-${project.slug}`;
---

<style>
  .project {
    min-height: 60vh;
    perspective: 1000px;
    .card {
      .box {
        border-radius: 5%;

        box-shadow: 2px 2px 10px rgba(255, 255, 255, 0.8);
        transition: transform 0.1s ease-out, box-shadow 0.1s ease-out;
    will-change: transform, box-shadow; /* Ottimizza le prestazioni GPU */
        #cover-prj {
          display: block;

          width: 100%;
          height: 100%;
        }
      }
    }
    .details {
      color: var(--text-color);
      .tech {
        text-align: center;
        font-size: 1rem;
      }
      .text {
        hr {
          width: 65%;
          height: 1px;
          border: 3px solid var(--th-color);
          border-radius: 10px;

          margin: 0 auto 1.5rem;
        }
        p {
          font-size: 1.2rem;
          margin-bottom: 2rem;
          line-height: 1.6rem;
        }
      }

      .cta {
        display: flex;
        justify-content: space-evenly;
        align-items: center;
        .links-p {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 1.5rem;
          a {
            font-size: 1.2rem;
            text-decoration: none;
            color: var(--color-primary);
          }
        }
      }
    }
  }

  @media screen and (max-width: 1224px) {
    .project {
      .card {
        width: 100%;
        .box {
          margin: 2rem auto;
          height: 300px;
          width: 300px;
        }
        #cover-prj {
          margin: auto;
          border-radius: 5%;
        }
      }

      .details {
        color: var(--text-color);
        text-align: center;
        .tech {
          font-size: 1rem;
        }
        .text {
          margin-bottom: 2rem;
          h2 {
            margin: 1rem 0 0.5rem;
          }
        }
        .cta {
          margin-bottom: 3rem;
          padding-bottom: 1rem;
          border-bottom: 2px solid transparent;
          border-image-source: radial-gradient(
            circle,
            var(--fo-color) 0%,
            var(--bg-color) 90%
          );
          border-image-slice: 1;
          p {
            display: none;
          }
        }
      }
    }
  }

  @media screen and (min-width: 1224px) {
    .project {
      --size: 500px;

      display: flex;
      justify-content: space-evenly;
      align-items: center;
      margin: 2rem 0;
      padding: 1rem;
      .card {
        width: 45%;
        height: 100%;
        height: auto;
        position: relative;
        perspective: 1000px;
      }
      .box {
        /* position: relative; */
        width: auto;
        height: auto;
        overflow: hidden;
        scale: 0.7;
        border-radius: 5%;
        transform: rotateX(0deg) rotateY(0deg);
        box-shadow: 2px 2px 10px rgba(255, 255, 255, 0.8);

        cursor: none;
        &:hover {
          scale: 0.9;

          /* box-shadow: -15px -15px 20px rgba(255, 255, 255, 0.596);  */
          transition: scale 0.3s ease-out;
        }
        .box:hover + .details {
          opacity: 1;
        }
      }

      img {
        display: block;

        width: 100%;
        height: 100%;
      }
    }
    .light {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      background: radial-gradient(
        circle at 50% 50%,
        rgba(255, 255, 255, 0.1),
        transparent 30%
      );
      transition: background-position 0.1s;
    }

    .details {
      width: 49%;
      padding: 1rem 4rem 2rem;
      color: var(--text-color);
      opacity: 0;

      .tech {
        text-align: center;
        font-size: 1rem;
      }
      .text {
        margin-top: 1rem;

        h2 {
          font-size: 2.5rem;
          margin-bottom: 0;
          transform: capitalize;
          text-align: center;
        }
      }
      .cta {
        display: flex;
        justify-content: space-evenly;
        align-items: center;
        .links-p {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 1.5rem;
          a {
            font-size: 1.2rem;
            text-decoration: none;
            color: var(--color-primary);
          }
        }
      }
    }
  }

</style>

<section class="project" data-project-container aria-labelledby={`${uniqueId}-title`}>
  <div class="card">
    <div class="box" tabindex="0" role="group" id={`${uniqueId}-box`} data-box>
      <Image id="cover-prj" src={project.data.cover} alt={project.data.title} />
      <div class="light" id={`${uniqueId}-light`} data-light></div>
    </div>
  </div>

  <div class="details" id={`${uniqueId}-details`} data-details>
    <p class="tech">{project.data.tech}</p>
    <div class="text">
      <h2 id={`${uniqueId}-title`}>{project.data.title}</h2>
      <hr />
      <p>{project.data.description}</p>
      <!-- <a href={`/portfolio/${project.slug}`}>Discover more:</a> -->
    </div>
    <div class="cta">
      <p>Discover more:</p>
      <div class="links-p">
        <a href={project.data.github} target="_blank" aria-label="Find out this project on Github"
          ><Icon class="icon" name="line-md:github-twotone" size="4rem"/></a
        >
        <a href={project.data.app} target="_blank" aria-label="Go to the web site of this project"
          ><Icon class="icon" name="line-md:link" size="4rem" /></a
        >
      </div>
    </div>
  </div>
</section>

<script define:vars={{ uniqueId }}>

 document.addEventListener("astro:page-load", () => {
  const initProjectEffect = () => {
    const containers = document.querySelectorAll('[data-project-container]');
    const isTouch = window.matchMedia("(pointer: coarse)").matches;

    containers.forEach(container => {
      const box = container.querySelector('[data-box]');
      const light = container.querySelector('[data-light]');
      const details = container.querySelector('[data-details]');

      if (!box || !light) return;
      
        const prefersReducedMotion = window.matchMedia(
        "(prefers-reduced-motion: reduce)"
      ).matches;

      if (prefersReducedMotion) return;

      // --- EFFETTO MOUSE (Solo se non Ã¨ touch) ---
      if (!isTouch) {
        box.addEventListener("mousemove", (e) => {
          const rect = box.getBoundingClientRect();
          const xCursor = e.clientX - rect.left;
          const yCursor = e.clientY - rect.top;
          
          const centerX = rect.width / 2;
          const centerY = rect.height / 2;
          const rotateX = (centerY - yCursor) / 10;
          const rotateY = (xCursor - centerX) / 10;

          box.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(0.95)`;
          box.style.boxShadow = `${-rotateY}px ${rotateX}px 30px rgba(255, 255, 255, 0.60)`;
          light.style.background = `radial-gradient(circle at ${xCursor}px ${yCursor}px, rgba(255,255,255,0.3), transparent 70%)`;
          details.style.opacity = "1";
        });

        box.addEventListener("mouseleave", () => {
          box.style.transform = `rotateX(0deg) rotateY(0deg) scale(0.9)`;
          box.style.transition = `scale 0.3s ease-out`
          light.style.background = "";
          // details.style.opacity = "0";
        });

        box.addEventListener("focus", () => {
            details.style.opacity = "1";         
        });
      }
    });
  };

  initProjectEffect();
});
</script>
